# Database Migrations

ูุฐุง ุงููุฌูุฏ ูุญุชูู ุนูู ุฌููุน migrations ูุงุนุฏุฉ ุงูุจูุงูุงุช.

## ๐ ูุงุฆูุฉ Migrations

### 0001_initial.sql
- ุฅูุดุงุก ุงูุฌุฏุงูู ุงูุฃุณุงุณูุฉ
- ุฅูุดุงุก Foreign Keys
- ุฅูุดุงุก Indices ุงูุฃุณุงุณูุฉ

### 0002_enhance_schema.sql
- ุฅุถุงูุฉ ุญููู ุฅุถุงููุฉ
- ุชุญุณูู ุงูุจููุฉ

### 0003_add_soft_delete.sql โจ ุฌุฏูุฏ
- ุฅุถุงูุฉ ุญูู `deleted_at` ูุฌููุน ุงูุฌุฏุงูู
- ุฅูุดุงุก indices ููู soft delete
- ุชูุนูู ูุธุงู ุงูุญุฐู ุงูุขูู

### 0004_add_constraints.sql โจ ุฌุฏูุฏ
- ุฅุถุงูุฉ triggers ููุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ุงูุชุญูู ูู ุฑูู ุงููุงุชู (10+ ุฃุฑูุงู)
- ุงูุชุญูู ูู ุงูููู ุงูููุฌุจุฉ (cost, price, salary)
- ุฑุณุงุฆู ุฎุทุฃ ุจุงูุนุฑุจูุฉ

### 0005_add_indices.sql โจ ุฌุฏูุฏ
- ุฅุถุงูุฉ search indices
- ุฅุถุงูุฉ composite indices
- ุฅุถุงูุฉ unique constraints
- ุชุญุณูู ุงูุฃุฏุงุก

### 0006_add_audit_trail.sql โจ ุฌุฏูุฏ
- ุฅูุดุงุก ุฌุฏูู `audit_log`
- ุชุชุจุน ุฌููุน ุงูุชุบููุฑุงุช
- ุฏุนู multi-user ูููุณุชูุจู

## ๐ ููููุฉ ุงูุชุดุบูู

Migrations ุชุนูู ุชููุงุฆูุงู ุนูุฏ ุจุฏุก ุงูุชุทุจูู. ูุชู ุชุชุจุน Migrations ุงููุทุจูุฉ ูู ุฌุฏูู `migrations_applied`.

### ูุฏููุงู (ููุชุทููุฑ)

```typescript
import { runMigrations } from './migrationRunner';

await runMigrations();
```

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ูุง ุชุนุฏู migrations ููุฌูุฏุฉ** - ุฃูุดุฆ migration ุฌุฏูุฏ ุจุฏูุงู ูู ุฐูู
2. **ุงุณุชุฎุฏู ุฃุฑูุงู ุชุณูุณููุฉ** - 0001, 0002, 0003, ุฅูุฎ
3. **ุงุฎุชุจุฑ ูุจู ุงูุชุทุจูู** - ุชุฃูุฏ ูู ุฃู migration ูุนูู ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
4. **ูุซู ุงูุชุบููุฑุงุช** - ุฃุถู ุชุนูููุงุช ูุงุถุญุฉ ูู ููู SQL

## ๐ ุฅูุดุงุก Migration ุฌุฏูุฏ

1. ุฃูุดุฆ ููู ุฌุฏูุฏ: `000X_description.sql`
2. ุฃุถู SQL commands
3. ุฃุถู ุชุนูููุงุช ุชูุถูุญูุฉ
4. ุงุฎุชุจุฑ ุนูู ูุงุนุฏุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
5. ุฃุถู ุฅูู Git

### ูุซุงู

```sql
-- Migration: Add new feature
-- Date: 2025-01-XX
-- Description: Brief description of changes

-- Your SQL commands here
ALTER TABLE table_name ADD COLUMN new_column TEXT;

-- Create indices if needed
CREATE INDEX IF NOT EXISTS idx_table_column ON table_name(new_column);
```

## ๐ Rollback

ุญุงููุงู ูุง ููุฌุฏ ุฏุนู ุชููุงุฆู ููู rollback. ูู ุญุงูุฉ ุงูุญุงุฌุฉ:

1. ุฃูุดุฆ migration ุฌุฏูุฏ ูุนูุณ ุงูุชุบููุฑุงุช
2. ุฃู ุงุณุชุนุฏ ูู backup

## ๐ ุญุงูุฉ Migrations

ููุชุญูู ูู Migrations ุงููุทุจูุฉ:

```sql
SELECT * FROM migrations_applied ORDER BY id;
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### Migration ูุดู

1. ุชุญูู ูู logs ูู console
2. ุชุญูู ูู ุฌุฏูู `migrations_applied`
3. ุงุณุชุนุฏ ูู backup ุฅุฐุง ูุฒู ุงูุฃูุฑ
4. ุฃุตูุญ ุงููุดููุฉ ูุฃุนุฏ ุงููุญุงููุฉ

### Migration ูุทุจู ุฌุฒุฆูุงู

1. ุชุญูู ูู ุญุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ูุฏ ุชุญุชุงุฌ ูุญุฐู ุงูุณุฌู ูู `migrations_applied`
3. ุฃุนุฏ ุชุดุบูู Migration

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-01-11